<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organization Management Dashboard</title>

    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

    <link rel="stylesheet" href="../assets/css/officerDashboard.css">
</head>

<body>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo-area">
            <i class="fa-solid fa-sitemap logo-icon"></i>
            <span class="logo-text">OrgManager</span>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="#" class="nav-link active" onclick="navigate('dashboard', this)">
                    <i class="fa-solid fa-gauge-high nav-icon"></i>
                    <span class="nav-label">Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="navigate('announcements', this)">
                    <i class="fa-solid fa-bullhorn nav-icon"></i>
                    <span class="nav-label">Announcements</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="navigate('events', this)">
                    <i class="fa-solid fa-calendar-days nav-icon"></i>
                    <span class="nav-label">Events</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="navigate('tracker', this)">
                    <i class="fa-solid fa-list-check nav-icon"></i>
                    <span class="nav-label">Services Tracker</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="navigate('documents', this)">
                    <i class="fa-solid fa-file-contract nav-icon"></i>
                    <span class="nav-label">Documents (OSA)</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="navigate('analytics', this)">
                    <i class="fa-solid fa-chart-line nav-icon"></i>
                    <span class="nav-label">Analytics</span>
                </a>
            </li>
        </ul>

        <div class="sidebar-footer">
            <!-- Desktop Theme Toggle -->
            <button class="theme-toggle" id="themeBtn">
                <i class="fa-solid fa-moon nav-icon"></i>
                <span class="nav-label">Dark Mode</span>
            </button>
            <div class="nav-item">
                <!-- Desktop Logout -->
                <a href="#" class="logout-btn" onclick="handleLogout(event)">
                    <i class="fa-solid fa-arrow-right-from-bracket nav-icon"></i>
                    <span class="nav-label">Logout</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- Top Header -->
        <header>
            <!-- Left: Page Title -->
            <div style="flex: 1;">
                <div class="header-title">
                    <h1 id="page-title">Dashboard</h1>
                    <p id="current-date">Fetching date...</p>
                </div>
            </div>

            <!-- Right: Controls -->
            <div class="header-controls">
                <!-- Mobile Theme Toggle -->
                <button class="icon-btn mobile-only" onclick="toggleThemeMobile()">
                    <i class="fa-solid fa-moon" id="mobile-theme-icon"></i>
                </button>

                <!-- Mobile Logout -->
                <a href="#" class="icon-btn mobile-only logout-icon" onclick="handleLogout(event)">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                </a>

                <!-- Desktop Notifications -->
                <div class="notif-wrapper" onclick="toggleNotifs()">
                    <div class="notif-btn">
                        <i class="fa-regular fa-bell"></i>
                        <span class="notif-badge" id="notif-count">3</span>
                    </div>
                    <div class="notif-dropdown" id="notif-dropdown">
                        <div class="notif-item">
                            <strong>New Event Proposal</strong>
                            <small>Submitted by Sports Club • 5m ago</small>
                        </div>
                        <div class="notif-item">
                            <strong>OSA Reminder</strong>
                            <small>Financial Statement due tomorrow</small>
                        </div>
                        <div class="notif-item">
                            <strong>System Alert</strong>
                            <small>Server backup completed</small>
                        </div>
                    </div>
                </div>

                <!-- User Profile -->
                <a href="profile.html" class="user-profile">
                    <img src="https://picsum.photos/seed/officer1/100/100" alt="Officer" class="avatar">
                    <div class="user-info">
                        <span>Admin Officer</span>
                        <small>Head of Operations</small>
                    </div>
                </a>
            </div>
        </header>

        <!-- DASHBOARD VIEW -->
        <div id="dashboard" class="section-view active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-info">
                        <div style="display: flex; align-items: baseline; gap: 6px;">
                            <h3>₱12.5k</h3>
                            <span style="color: #059669; font-size: 0.8rem; font-weight: 600;">
                                <i class="fa-solid fa-arrow-up"></i> 8.5%
                            </span>
                            <span style="color: var(--muted); font-size: 0.75rem;">vs last month</span>
                        </div>
                        <p>Revenue (February)</p>
                    </div>
                    <div class="stat-icon"><i class="fa-solid fa-wallet"></i></div>
                </div>
                <div class="stat-card">
                    <div class="stat-info">
                        <h3 style="color: #059669;">+12%</h3>
                        <p style="margin-bottom: 5px;">Participation Growth</p>

                        <div style="font-size: 0.75rem; line-height: 1.3;">
                            <span style="color: var(--muted);">Based on previous event:</span>
                            <div style="font-weight: 600; color: var(--muted);">
                                General Assembly (Jan 25)
                            </div>
                        </div>
                    </div>
                    <div class="stat-icon"><i class="fa-solid fa-arrow-trend-up"></i></div>
                </div>
                <div class="stat-card">
                    <div class="stat-info">
                        <h3>14</h3>
                        <p>Active Rentals</p>
                        <p id="rentals-stat-date" style="color: var(--muted); font-size: 0.85rem; margin-top: 2px;">
                            Fetching date...
                        </p>
                    </div>
                    <div class="stat-icon"><i class="fa-solid fa-box"></i></div>
                </div>
                <div class="stat-card" style="flex-direction: column; align-items: flex-start; gap: 10px;">
                    <div
                        style="width: 100%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding-bottom: 8px;">
                        <div>
                            <span style="font-weight: 600; color: var(--text); display: block;">Document Status</span>
                            <small style="color: var(--muted); font-size: 0.75rem;">(February)</small>
                        </div>
                        <i class="fa-solid fa-file-contract" style="color: var(--muted);"></i>
                    </div>

                    <div
                        style="width: 100%; display: flex; justify-content: space-between; text-align: center; padding-top: 5px;">
                        <div style="flex: 1;">
                            <h3 style="color: #d97706; font-size: 1.2rem; margin-bottom: 0;">2</h3>
                            <p style="font-size: 0.7rem; color: var(--muted);">Pending</p>
                        </div>
                        <div
                            style="flex: 1; border-left: 1px solid var(--border); border-right: 1px solid var(--border);">
                            <h3 style="color: #059669; font-size: 1.2rem; margin-bottom: 0;">15</h3>
                            <p style="font-size: 0.7rem; color: var(--muted);">Accepted</p>
                        </div>
                        <div style="flex: 1;">
                            <h3 style="color: #dc2626; font-size: 1.2rem; margin-bottom: 0;">1</h3>
                            <p style="font-size: 0.7rem; color: var(--muted);">Rejected</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-row">
                <!-- Recent Services/Rentals -->
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">Active Rentals & Services</div>
                            <p id="rentals-date" style="color: var(--muted); font-size: 0.85rem; margin-top: 2px;">
                                Fetching date...
                            </p>
                        </div>
                        <button class="btn btn-outline btn-sm" onclick="viewAllRentals()">View All</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Item/Service</th>
                                    <th>Borrower</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="dashboard-rentals-table">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Latest Updates -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Latest Updates</div>
                    </div>
                    <div class="dash-announcement">
                        <h5>
                            General Assembly
                            <small style="font-weight: 400; font-size: 0.7rem; color: var(--muted);">Today</small>
                        </h5>
                        <p>Mandatory attendance for all members at Room 301. Please bring your IDs.</p>
                    </div>
                    <div class="dash-announcement">
                        <h5>
                            Office Closure
                            <small style="font-weight: 400; font-size: 0.7rem; color: var(--muted);">Yesterday</small>
                        </h5>
                        <p>Office will be closed due to University Holiday. Operations resume Monday.</p>
                    </div>
                </div>

                <!-- Upcoming Events -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Upcoming Events</div>
                        <button class="btn btn-outline btn-sm" onclick="viewEventsList()">View Events</button>
                    </div>
                    <div class="event-list">
                        <div class="event-item">
                            <div class="event-date-box">
                                <span class="event-day">15</span>
                                <span class="event-month">Feb</span>
                            </div>
                            <div class="event-details">
                                <h4>Tech Innovation Summit</h4>
                                <p><i class="fa-regular fa-clock"></i> 9:00 AM • Auditorium A</p>
                            </div>
                        </div>
                        <div class="event-item">
                            <div class="event-date-box">
                                <span class="event-day">22</span>
                                <span class="event-month">Feb</span>
                            </div>
                            <div class="event-details">
                                <h4>Inter-Org Sports Fest</h4>
                                <p><i class="fa-regular fa-clock"></i> 8:00 AM • University Oval</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Quick Actions</div>
                    </div>
                    <div style="display: grid; gap: 10px;">
                        <button class="btn btn-primary" onclick="navigate('announcements')">
                            <i class="fa-solid fa-pen-to-square"></i> Post Announcement
                        </button>
                        <button class="btn btn-outline" onclick="navigate('events')">
                            <i class="fa-solid fa-calendar-days"></i> Events
                        </button>
                        <button class="btn btn-outline" onclick="navigate('tracker')">
                            <i class="fa-solid fa-qrcode"></i> Services
                        </button>
                        <button class="btn btn-outline" onclick="navigate('documents')">
                            <i class="fa-solid fa-file-contract"></i> Document
                        </button>
                        <button class="btn btn-outline" onclick="navigate('analytics')">
                            <i class="fa-solid fa-chart-line"></i> Analytics
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SERVICES TRACKER VIEW -->
        <div id="tracker" class="section-view">
            <div class="card">
                <iframe src="../systems/IGPRentalSystem/index.html" title="IGP Rental System">
                </iframe>
            </div>
        </div>

        <!-- DOCUMENTS VIEW -->
        <div id="documents" class="section-view">
            <div class="content-row">
                <!-- Upload Form -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Compile Document for OSA</div>
                    </div>
                    <form id="doc-form" onsubmit="handleDocSubmit(event)">
                        <label>Recipient</label>
                        <select id="doc-recipient" required>
                            <option value="OSA">OSA (Office of Student Affairs)</option>
                            <option value="SSC">SSC (Supreme Student Council)</option>
                        </select>

                        <label>Document Type</label>
                        <select id="doc-type" required>
                            <option value="Activity Report">Activity Report</option>
                            <option value="Financial Statement">Financial Statement</option>
                            <option value="Proposal">Event Proposal</option>
                            <option value="Roster">Updated Roster</option>
                        </select>

                        <label>Title</label>
                        <input type="text" placeholder="e.g., Semestral Financial Report" required>

                        <label>Description/Notes</label>
                        <textarea rows="3" placeholder="Brief details..."></textarea>

                        <label>Attach File</label>
                        <div
                            style="border: 2px dashed var(--border); padding: 20px; text-align: center; border-radius: var(--radius-md); margin-bottom: 20px; cursor: pointer; color: var(--muted);">
                            <i class="fa-solid fa-cloud-arrow-up"></i> Click to upload PDF
                        </div>

                        <button type="submit" class="btn btn-primary">
                            <i class="fa-solid fa-paper-plane"></i> Send for Checking
                        </button>
                    </form>
                </div>

                <!-- Submission History -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Submission History</div>
                        <div class="filter-group" style="flex-direction: row; gap: 5px;">
                            <button class="btn btn-outline btn-sm active" id="filter-all"
                                onclick="filterDocs('All')">All</button>
                            <button class="btn btn-outline btn-sm" id="filter-osa"
                                onclick="filterDocs('OSA')">OSA</button>
                            <button class="btn btn-outline btn-sm" id="filter-ssc"
                                onclick="filterDocs('SSC')">SSC</button>
                        </div>
                    </div>
                    <div id="docs-list">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ANALYTICS VIEW -->
        <div id="analytics" class="section-view">

            <div class="analytics-toolbar card">
                <div class="filters">
                    <div class="filter-group">
                        <label>Academic Year</label>
                        <select id="filter-year">
                            <option>2023-2024</option>
                            <option>2022-2023</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Select Month</label>
                        <input type="month" id="filter-month">
                    </div>
                </div>
                <div class="export-wrapper">
                    <button class="btn btn-outline btn-sm" onclick="toggleExportMenu()">
                        <i class="fa-solid fa-download"></i> Export Report <i class="fa-solid fa-caret-down ms-2"></i>
                    </button>
                    <div class="export-dropdown" id="export-dropdown">
                        <div class="export-item" onclick="exportCSV()">
                            <i class="fa-solid fa-file-csv"></i> Download CSV
                        </div>
                        <div class="export-item" onclick="exportPDF()">
                            <i class="fa-solid fa-file-pdf"></i> Download PDF
                        </div>
                    </div>
                </div>
            </div>

            <div class="analytics-grid">

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fa-solid fa-wallet me-2" style="color: #002147;"></i> Financial Performance
                        </div>
                    </div>
                    <div class="chart-container-relative">
                        <canvas id="revenueChart"></canvas>
                    </div>
                    <div class="mt-3"
                        style="display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--muted); padding-top: 10px; border-top: 1px solid var(--border);">
                        <span>Total: <strong>₱12,500</strong></span>
                        <span style="color: #059669;"><i class="fa-solid fa-arrow-up"></i> 8.5% Growth</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fa-solid fa-arrow-trend-up me-2" style="color: #059669;"></i> Participation Trends
                        </div>
                    </div>
                    <div class="chart-container-relative">
                        <canvas id="participationChart"></canvas>
                    </div>
                    <div class="mt-3"
                        style="display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--muted); padding-top: 10px; border-top: 1px solid var(--border);">
                        <span>Avg Attendance: <strong>150</strong></span>
                        <span>Retention: <strong>High</strong></span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fa-solid fa-box me-2" style="color: #d97706;"></i> Inventory Utilization
                        </div>
                    </div>
                    <div style="display: flex; height: 100%; align-items: center; justify-content: center;">
                        <div style="width: 60%; height: 200px;">
                            <canvas id="rentalsChart"></canvas>
                        </div>
                        <div style="width: 40%; padding-left: 10px; font-size: 0.85rem;">
                            <div style="margin-bottom: 8px;"><strong>14</strong> Active</div>
                            <div style="margin-bottom: 8px; color: #d97706;"><strong>4</strong> Pending</div>
                            <div style="color: #dc2626;"><strong>2</strong> Overdue</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fa-solid fa-file-contract me-2" style="color: var(--muted);"></i> Document
                            Workflow
                        </div>
                    </div>
                    <div style="display: flex; height: 100%; align-items: center;">
                        <div style="width: 50%; height: 200px;">
                            <canvas id="docsChart"></canvas>
                        </div>
                        <div style="width: 50%; font-size: 0.85rem;">
                            <ul style="list-style: none;">
                                <li style="margin-bottom: 8px; display: flex; align-items: center;"><span
                                        style="width: 10px; height: 10px; background: #059669; border-radius: 50%; margin-right: 8px;"></span>
                                    Accepted (15)</li>
                                <li style="margin-bottom: 8px; display: flex; align-items: center;"><span
                                        style="width: 10px; height: 10px; background: #d97706; border-radius: 50%; margin-right: 8px;"></span>
                                    Pending (2)</li>
                                <li style="display: flex; align-items: center;"><span
                                        style="width: 10px; height: 10px; background: #dc2626; border-radius: 50%; margin-right: 8px;"></span>
                                    Rejected (1)</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- ANNOUNCEMENTS VIEW -->
        <div id="announcements" class="section-view">
            <div class="content-row">
                <!-- Create Post -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Create Announcement</div>
                    </div>
                    <form id="announcement-form" onsubmit="postAnnouncement(event)">
                        <label>Target Audience</label>
                        <select>
                            <option>All Students</option>
                            <option>Org Members Only</option>
                            <option>Officers</option>
                        </select>

                        <label>Headline</label>
                        <input type="text" id="ann-title" placeholder="Enter headline..." required>

                        <label>Content</label>
                        <textarea id="ann-content" rows="4" placeholder="Type details here..." required></textarea>

                        <div class="sync-option">
                            <label>
                                <input type="checkbox" id="sync-event">
                                <span class="sync-text">
                                    <i class="fa-solid fa-calendar-plus"></i>
                                    Also create this as an Event
                                </span>
                            </label>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <label style="margin: 0; font-weight: 400; font-size: 0.85rem;">
                                <input type="checkbox" style="width: auto; margin-right: 5px;"> Mark as Urgent
                            </label>
                            <button type="submit" class="btn btn-primary">
                                <i class="fa-regular fa-paper-plane"></i> Publish
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Feed Preview -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Live Feed</div>
                    </div>
                    <div id="announcement-feed" style="max-height: 400px; overflow-y: auto;">
                        <!-- Populated JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- EVENTS VIEW -->
        <div id="events" class="section-view">
            <div class="card">
                <iframe src="../systems/QR-Attendance/index.html" title="QR Attendance System">
                </iframe>
            </div>
        </div>

    </main>

    <!-- Custom JS -->
    <script src="../assets/js/officerAnalytics.js"></script>
    <script src="../assets/js/officerDashboard.js"></script>
</body>

</html>