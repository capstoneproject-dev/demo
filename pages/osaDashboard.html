<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSA Management System</title>

    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- CSS Reference -->
    <link rel="stylesheet" href="../assets/css/osaDashboard.css">

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf_viewer.min.css">

    <!-- PDF Viewer Styles -->
    <link rel="stylesheet" href="../assets/css/pdfViewer.css">
</head>

<body>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo-area">
            <i class="fa-solid fa-building-columns logo-icon"></i>
            <span class="logo-text">OSA Portal</span>
        </div>

        <ul class="nav-menu">
            <li class="nav-item">
                <a href="#" class="nav-link active" onclick="navigate('dashboard', this)">
                    <i class="fa-solid fa-chart-pie nav-icon"></i>
                    <span class="nav-label">Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="navigate('organizations', this)">
                    <i class="fa-solid fa-users nav-icon"></i>
                    <span class="nav-label">Organizations</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="navigate('requests', this)">
                    <i class="fa-solid fa-file-signature nav-icon"></i>
                    <span class="nav-label">Requests & Approval</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" onclick="navigate('documents', this)">
                    <i class="fa-solid fa-folder-open nav-icon"></i>
                    <span class="nav-label">Documents</span>
                </a>
            </li>
            </li>
        </ul>

        <div class="sidebar-footer">
            <button class="theme-toggle" id="themeBtn">
                <i class="fa-solid fa-moon nav-icon"></i>
                <span class="nav-label">Dark Mode</span>
            </button>
            <div class="nav-item">
                <a href="#" class="logout-btn" onclick="handleLogout(event)">
                    <i class="fa-solid fa-arrow-right-from-bracket nav-icon"></i>
                    <span class="nav-label">Logout</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- Top Header (Integrated with Prompt Code) -->
        <header>
            <!-- Left: Page Title -->
            <div class="header-title">
                <h1 id="page-title">OSA Dashboard</h1>
                <p id="current-date">Fetching date...</p>
            </div>

            <!-- Right: Controls (From Prompt) -->
            <div class="header-controls">
                <!-- Mobile Theme Toggle -->
                <button class="icon-btn mobile-only" onclick="switchThemeLogic()">
                    <i class="fa-solid fa-moon" id="mobile-theme-icon"></i>
                </button>

                <!-- Mobile Logout -->
                <a href="#" class="icon-btn mobile-only logout-icon" onclick="handleLogout(event)">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                </a>

                <!-- User Profile -->
                <a href="#" class="user-profile" onclick="showToast('Navigate to Profile (Demo)', 'info')">
                    <img src="https://picsum.photos/seed/osaadmin/100/100" alt="Student" class="avatar">
                    <div class="user-info">
                        <span style="display: block; font-size: 0.85rem; font-weight: 600;">Dir. Maria Santos</span>
                        <small style="color: var(--muted); font-size: 0.75rem;">OSA Head</small>
                    </div>
                </a>
            </div>
        </header>

        <!-- DASHBOARD VIEW -->
        <div id="dashboard" class="section-view active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-info">
                        <div style="display: flex; align-items: baseline; gap: 6px;">
                            <h3>8</h3>
                            <span style="color: #059669; font-size: 0.8rem; font-weight: 600;">
                                <i class="fa-solid fa-circle"></i> Online
                            </span>
                        </div>
                        <p>Active Officers</p>
                    </div>
                    <div class="stat-icon"><i class="fa-solid fa-user-tie"></i></div>
                </div>

                <div class="stat-card">
                    <div class="stat-info">
                        <div style="display: flex; align-items: baseline; gap: 6px;">
                            <h3>450</h3>
                            <span style="color: #059669; font-size: 0.8rem; font-weight: 600;">
                                <i class="fa-solid fa-circle"></i> Online
                            </span>
                        </div>
                        <p>Active Students</p>
                    </div>
                    <div class="stat-icon"><i class="fa-solid fa-user-check"></i></div>
                </div>

                <div class="stat-card">
                    <div class="stat-info">
                        <div style="display: flex; align-items: baseline; gap: 6px;">
                            <h3>12</h3>
                            <span style="color: #d97706; font-size: 0.8rem; font-weight: 600;">
                                <i class="fa-regular fa-clock"></i> Pending
                            </span>
                        </div>
                        <p>Request Queue</p>
                    </div>
                    <div class="stat-icon"><i class="fa-solid fa-file-signature"></i></div>
                </div>

                <div class="stat-card">
                    <div class="stat-info">
                        <div style="display: flex; align-items: baseline; gap: 6px;">
                            <h3>85%</h3>
                            <span style="color: #059669; font-size: 0.8rem; font-weight: 600;">
                                <i class="fa-solid fa-arrow-trend-up"></i> +5%
                            </span>
                        </div>
                        <p>Engagement Rate</p>
                    </div>
                    <div class="stat-icon"><i class="fa-solid fa-bolt"></i></div>
                </div>
            </div>

            <div class="content-row">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <div class="card-title">Recent Requests</div>
                            <p style="color: var(--muted); font-size: 0.85rem; margin-top: 2px;">
                                Awaiting Admin Action
                            </p>
                        </div>
                        <button class="btn btn-outline btn-sm" onclick="navigate('requests')">View All</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Organization</th>
                                    <th>Title</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="dashboard-requests-preview">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div style="display: flex; flex-direction: column; gap: 24px;">

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Quick Actions</div>
                        </div>
                        <div class="quick-action-grid">
                            <button class="btn btn-primary" onclick="navigate('requests')">
                                <i class="fa-solid fa-list-check"></i> Review Requests
                            </button>
                            <button class="btn btn-outline" onclick="navigate('organizations')">
                                <i class="fa-solid fa-users-viewfinder"></i> Monitor Orgs
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Recent Activity</div>
                        </div>
                        <div id="activity-feed" class="activity-list">
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- ORGANIZATIONS LIST VIEW -->
        <div id="organizations" class="section-view">
            <div class="split-view-grid">
                <!-- LEFT HALF: Organization List -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Accredited Student Organizations</div>
                        <input type="text" placeholder="Search Orgs..." style="margin-bottom: 0; width: 250px;">
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Organization Name</th>
                                    <th class="text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody id="org-list-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- RIGHT HALF: Recent Documents -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Recent Documents</div>
                        <label class="btn btn-sm btn-primary" style="cursor: pointer;">
                            <i class="fa-solid fa-upload"></i> Upload PDF
                            <input type="file" id="pdf-upload-input" accept=".pdf" style="display: none;"
                                onchange="handlePdfUpload(event)">
                        </label>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Organization</th>
                                    <th>Sender</th>
                                    <th>Document Name</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-table-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- MONITORING PANEL (Sub-view of Orgs) -->
        <div id="monitoring" class="section-view">
            <button class="btn btn-outline btn-sm" onclick="navigate('organizations')" style="margin-bottom: 20px;">
                <i class="fa-solid fa-arrow-left"></i> Back to List
            </button>

            <div class="card" style="margin-bottom: 24px; border-left: 5px solid var(--primary);">
                <div class="card-header">
                    <div>
                        <h2 id="monitoring-org-name" style="font-size: 1.5rem; margin-bottom: 5px;">Organization Name
                        </h2>
                        <p id="monitoring-org-details" style="color: var(--muted);">Details here</p>
                    </div>
                    <div class="status-badge status-completed">Good Standing</div>
                </div>

                <!-- Financial Report Section -->
                <h3 style="font-size: 1.1rem; margin-bottom: 15px;">Financial Report Status</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div style="background: var(--panel-2); padding: 15px; border-radius: var(--radius-md);">
                        <small>Current Balance</small>
                        <div style="font-size: 1.2rem; font-weight: 700;">₱ 15,400.00</div>
                    </div>
                    <div style="background: var(--panel-2); padding: 15px; border-radius: var(--radius-md);">
                        <small>Last Audit</small>
                        <div style="font-size: 1.2rem; font-weight: 700; color: #059669;">Passed</div>
                    </div>
                    <div style="background: var(--panel-2); padding: 15px; border-radius: var(--radius-md);">
                        <small>Pending Dues</small>
                        <div style="font-size: 1.2rem; font-weight: 700;">₱ 500.00</div>
                    </div>
                </div>
            </div>

            <div class="content-row">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Event History</div>
                    </div>
                    <table class="table-container">
                        <thead>
                            <tr>
                                <th>Event Name</th>
                                <th>Date</th>
                                <th>Attendance</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="monitoring-events-table">
                            <!-- JS -->
                        </tbody>
                    </table>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Quick Actions</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button class="btn btn-outline" onclick="showToast('Audit Request Sent to Treasurer')">
                            <i class="fa-solid fa-file-invoice-dollar"></i> Request Financial Audit
                        </button>
                        <button class="btn btn-outline" onclick="navigate('documents')">
                            <i class="fa-solid fa-file-shield"></i> View Submitted Documents
                        </button>
                        <button class="btn btn-danger"
                            onclick="showToast('Warning sent to Organization President', 'error')">
                            <i class="fa-solid fa-triangle-exclamation"></i> Issue Sanction
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- REQUESTS & APPROVAL VIEW -->
        <div id="requests" class="section-view">
            <div class="card">
                <!-- Simplified Filter Bar -->
                <div class="requests-filter-bar">
                    <!-- Status Tabs -->
                    <div class="req-tabs">
                        <button class="req-tab active" onclick="switchReqStatus('all', this)">Overview</button>
                        <button class="req-tab" onclick="switchReqStatus('Pending', this)">Pending</button>
                        <button class="req-tab" onclick="switchReqStatus('Approved', this)">Approved</button>
                        <button class="req-tab" onclick="switchReqStatus('Rejected', this)">Rejected</button>
                    </div>

                    <!-- Filter Controls -->
                    <div class="req-filter-controls">
                        <select id="req-type-filter" onchange="renderRequests()">
                            <option value="all">All Types</option>
                            <option value="Event Proposal">Event Proposals</option>
                            <option value="Posting">Posting Approval</option>
                            <option value="Document">Document Submissions</option>
                        </select>

                        <select id="req-org-filter" onchange="renderRequests()">
                            <option value="all">All Organizations</option>
                            <!-- Populated via JS -->
                        </select>

                        <button class="date-range-btn" onclick="openDatePicker()">
                            <i class="fa-solid fa-calendar-days"></i>
                            <span id="date-range-label">Select Date Range</span>
                        </button>

                        <button class="btn btn-outline btn-sm" onclick="clearRequestFilters()">
                            <i class="fa-solid fa-filter-circle-xmark"></i> Clear
                        </button>
                    </div>
                </div>

                <!-- Table -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Organization</th>
                                <th>Sender</th>
                                <th>Subject/Title</th>
                                <th>Date Submitted</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="requests-table">
                            <!-- JS Populated -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- DOCUMENTS VIEW -->
        <!-- DOCUMENTS VIEW -->
        <div id="documents" class="section-view">
            <div class="docs-layout">
                <div class="repo-main card">
                    <div class="repo-filters">
                        <div class="filter-tabs-group">
                            <button class="filter-tab active" onclick="filterDocs('All', this)">All Files</button>
                            <button class="filter-tab" onclick="filterDocs('Approved', this)">Approved</button>
                            <button class="filter-tab" onclick="filterDocs('Rejected', this)">Rejected</button>
                            <button class="filter-tab" onclick="filterDocs('Pending', this)">Pending</button>
                        </div>
                    </div>

                    <!-- List Header (5 Columns) -->
                    <div class="list-header-row mobile-hide">
                        <div class="col-name">Name & Type</div>
                        <div class="col-sent">Sent By</div>
                        <div class="col-ssc">SSC Review</div>
                        <div class="col-osa">OSA Approval</div>
                        <div class="col-status">Status</div>
                    </div>

                    <!-- Scrollable List Container -->
                    <div id="docs-list">
                        <!-- Data populated via osaDashboard.js -->
                    </div>
                </div>

                <div class="repo-sidebar">
                    <div class="card" style="padding: 0; display: flex; flex-direction: column; height: 100%;">
                        <div class="repo-filters">
                            <span class="header-text-label">Recent Activities</span>
                        </div>
                        <div id="recent-docs-list">
                            <!-- Data populated via osaDashboard.js -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Request Action Confirmation Modal -->
    <div id="request-action-modal" class="request-action-modal">
        <div class="request-action-modal-content">
            <div class="request-action-modal-header">
                <h3 id="request-action-title">Confirm Action</h3>
                <button class="modal-close-btn" onclick="closeRequestActionModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="request-action-modal-body">
                <p id="request-action-message">Are you sure you want to perform this action? This cannot be undone.</p>
                <p id="request-action-instruction" style="margin-top: 12px; font-size: 0.9rem;">
                    Type <strong id="request-action-keyword">"Approve"</strong> to confirm:
                </p>
                <input type="text" id="request-action-input" placeholder="Type here to confirm"
                    style="margin-top: 8px;" />
            </div>
            <div class="request-action-modal-footer">
                <button class="btn btn-outline" onclick="closeRequestActionModal()">Cancel</button>
                <button class="btn btn-primary" id="request-action-confirm-btn" onclick="confirmRequestAction()">
                    Confirm Action
                </button>
            </div>
        </div>
    </div>

    <!-- Date Range Calendar Modal -->
    <div id="date-picker-modal" class="date-picker-modal">
        <div class="date-picker-content">
            <div class="date-picker-header">
                <h3>Select Date Range</h3>
                <button class="modal-close-btn" onclick="closeDatePicker()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <div class="date-picker-body">
                <!-- Calendar Navigation -->
                <div class="calendar-nav">
                    <button onclick="changeCalendarMonth(-1)">
                        <i class="fa-solid fa-chevron-left"></i>
                    </button>
                    <div class="calendar-month-year">
                        <span id="calendar-month-label">January 2024</span>
                    </div>
                    <button onclick="changeCalendarMonth(1)">
                        <i class="fa-solid fa-chevron-right"></i>
                    </button>
                </div>

                <!-- Calendar Grid -->
                <div class="calendar-grid">
                    <div class="calendar-weekdays">
                        <div>Sun</div>
                        <div>Mon</div>
                        <div>Tue</div>
                        <div>Wed</div>
                        <div>Thu</div>
                        <div>Fri</div>
                        <div>Sat</div>
                    </div>
                    <div id="calendar-dates" class="calendar-dates">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Selected Range Display -->
                <div class="date-range-display">
                    <div class="date-range-item">
                        <label>From:</label>
                        <span id="selected-from-date">Not selected</span>
                    </div>
                    <div class="date-range-item">
                        <label>To:</label>
                        <span id="selected-to-date">Not selected</span>
                    </div>
                </div>
            </div>

            <div class="date-picker-footer">
                <button class="btn btn-outline" onclick="clearDateRange()">Clear</button>
                <button class="btn btn-primary" onclick="applyDateRange()">Apply</button>
            </div>
        </div>
    </div>



    <!-- PDF Viewer Modal (Google Drive Style) -->
    <div id="pdf-modal" class="pdf-modal">
        <div class="pdf-modal-content">
            <!-- Modal Header -->
            <div class="pdf-modal-header">
                <div class="pdf-modal-title">
                    <i class="fa-solid fa-file-pdf"></i>
                    <span id="pdf-doc-name">Document</span>
                </div>
                <div class="pdf-toolbar">
                    <!-- Navigation -->
                    <button class="btn btn-sm btn-outline nav-btn" onclick="pdfPrevPage()" title="Previous Page">
                        <i class="fa-solid fa-chevron-left"></i>
                    </button>
                    <span id="pdf-page-info" class="pdf-toolbar-info">0 pages</span>
                    <button class="btn btn-sm btn-outline nav-btn" onclick="pdfNextPage()" title="Next Page">
                        <i class="fa-solid fa-chevron-right"></i>
                    </button>
                    <div class="pdf-toolbar-divider"></div>
                    <!-- Zoom -->
                    <button class="btn btn-sm btn-outline zoom-btn" onclick="pdfZoomOut()" title="Zoom Out">
                        <i class="fa-solid fa-minus"></i>
                    </button>
                    <span id="pdf-zoom-info" class="pdf-toolbar-info">100%</span>
                    <button class="btn btn-sm btn-outline zoom-btn" onclick="pdfZoomIn()" title="Zoom In">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                    <div class="pdf-toolbar-divider"></div>
                    <!-- Annotation Tools -->
                    <button id="pdf-highlight-btn" class="btn btn-sm btn-outline" onclick="togglePdfHighlightMode()"
                        title="Highlight Text">
                        <i class="fa-solid fa-highlighter"></i>
                    </button>
                    <button id="pdf-comment-btn" class="btn btn-sm btn-outline" onclick="togglePdfCommentMode()"
                        title="Add Comment">
                        <i class="fa-solid fa-comment"></i>
                    </button>
                    <div class="pdf-toolbar-divider"></div>
                    <!-- Sidebar Toggle -->
                    <button class="btn btn-sm btn-outline" onclick="togglePdfSidebar()" title="Toggle Sidebar">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                </div>
                <button class="pdf-close-btn" onclick="closePdfViewer()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="pdf-modal-body">
                <!-- PDF Viewer Container (pages render here) -->
                <div id="pdf-viewer-container" class="pdf-viewer-container">
                    <div class="pdf-loading">
                        <i class="fa-solid fa-spinner"></i>
                        <p>Select a document to view</p>
                    </div>
                </div>

                <!-- Floating Sidebar Toggle (Visible when sidebar is collapsed) -->
                <button id="pdf-sidebar-toggle" class="pdf-sidebar-toggle" onclick="togglePdfSidebar()"
                    title="Show Annotations">
                    <i class="fa-solid fa-angles-left"></i>
                </button>

                <!-- Annotations Sidebar -->
                <div id="pdf-sidebar" class="pdf-sidebar">
                    <div class="pdf-sidebar-header">
                        <h4>Annotations</h4>
                        <button class="btn btn-sm btn-outline" onclick="togglePdfSidebar()">
                            <i class="fa-solid fa-angles-right"></i>
                        </button>
                    </div>
                    <div id="pdf-annotations-list" class="pdf-sidebar-content">
                        <div class="pdf-no-annotations">
                            <i class="fa-solid fa-note-sticky"></i>
                            <p>No annotations yet<br><small>Select text to add highlights or comments</small></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comment Input Modal -->
    <div id="pdf-comment-modal" class="pdf-comment-modal">
        <div class="pdf-comment-modal-content">
            <h4>Add Comment</h4>
            <div id="pdf-selected-text-preview" class="selected-text-preview"></div>
            <textarea id="pdf-comment-textarea" placeholder="Enter your comment..."></textarea>
            <div class="pdf-comment-modal-actions">
                <button class="btn btn-sm btn-outline" onclick="cancelPdfComment()">Cancel</button>
                <button class="btn btn-sm btn-primary" onclick="savePdfComment()">Save</button>
            </div>
        </div>
    </div>

    <!-- JS References -->
    <script src="../assets/js/osaDashboard.js"></script>
    <script src="../assets/js/pdfViewer.js"></script>
</body>

</html>